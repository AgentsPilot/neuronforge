# Complete NeuronForge System Flow
## All Subsystems Integration: AIS, Memory, Executions, Audit Trail, Analytics

---

## ğŸ¯ High-Level System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            USER INTERACTIONS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  Create Agent    Configure AIS    Run Execution    View Analytics    Approve    â”‚
â”‚       â”‚               â”‚                 â”‚                â”‚              â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚                 â”‚                â”‚              â”‚
        â–¼               â–¼                 â–¼                â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CORE ORCHESTRATION LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚   Agent      â”‚  â”‚   Pilot      â”‚  â”‚  Approval    â”‚  â”‚  Analytics   â”‚       â”‚
â”‚   â”‚  Creation    â”‚  â”‚  Executor    â”‚  â”‚   System     â”‚  â”‚   Engine     â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                 â”‚                 â”‚                 â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚                 â”‚                 â”‚
           â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        INTELLIGENT SUBSYSTEMS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚    AIS      â”‚  â”‚   Memory    â”‚  â”‚   Routing   â”‚  â”‚ Audit Trail â”‚            â”‚
â”‚  â”‚   System    â”‚  â”‚   System    â”‚  â”‚   Engine    â”‚  â”‚   Service   â”‚            â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚            â”‚
â”‚  â”‚ â€¢ Scoring   â”‚  â”‚ â€¢ Learning  â”‚  â”‚ â€¢ Model     â”‚  â”‚ â€¢ SOC2      â”‚            â”‚
â”‚  â”‚ â€¢ Config    â”‚  â”‚ â€¢ Patterns  â”‚  â”‚   Selection â”‚  â”‚ â€¢ Events    â”‚            â”‚
â”‚  â”‚ â€¢ Weights   â”‚  â”‚ â€¢ Context   â”‚  â”‚ â€¢ Tiers     â”‚  â”‚ â€¢ Tracking  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â”‚                â”‚                â”‚                â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATABASE LAYER (Supabase)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  agents  â”‚  executions  â”‚  pilot_steps  â”‚  agent_memories  â”‚  audit_logs        â”‚
â”‚  system_settings  â”‚  pilot_step_routing_history  â”‚  analytics_cache            â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Agent Execution Flow

### Flow 1: Agent Creation & Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: AGENT CREATION                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Creates Agent
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Smart Agent Builder UI                   â”‚
â”‚  (/agents/new)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent Configuration                      â”‚
â”‚  â€¢ Name, Description, Goal                â”‚
â”‚  â€¢ Intensity Score (AIS): 0-10            â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ Pilot Enabled: true/false              â”‚       â”‚
â”‚  â€¢ Model Preference: default model        â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
               â”‚                                    â”‚
               â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  AIS Analysis (if enabled)                â”‚       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚       â”‚
â”‚  IntentAnalyzer analyzes:                 â”‚       â”‚
â”‚  â€¢ Goal complexity                        â”‚       â”‚
â”‚  â€¢ Required capabilities                  â”‚       â”‚
â”‚  â€¢ Expected interactions                  â”‚       â”‚
â”‚  â€¢ Resource requirements                  â”‚       â”‚
â”‚                                           â”‚       â”‚
â”‚  Calculates AIS: 0-10 score               â”‚       â”‚
â”‚  â€¢ 0-3: Simple automation                 â”‚       â”‚
â”‚  â€¢ 4-6: Moderate reasoning                â”‚       â”‚
â”‚  â€¢ 7-10: Complex decision-making          â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
               â”‚                                    â”‚
               â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  Pilot Step Generation                    â”‚       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚       â”‚
â”‚  AI generates workflow steps:             â”‚       â”‚
â”‚  â€¢ LLM Decision steps                     â”‚       â”‚
â”‚  â€¢ Transform steps                        â”‚       â”‚
â”‚  â€¢ Conditional branches                   â”‚       â”‚
â”‚  â€¢ API call steps                         â”‚       â”‚
â”‚  â€¢ Action steps                           â”‚       â”‚
â”‚                                           â”‚       â”‚
â”‚  Each step includes:                      â”‚       â”‚
â”‚  â€¢ Type, name, prompt                     â”‚       â”‚
â”‚  â€¢ Input/output mappings                  â”‚       â”‚
â”‚  â€¢ Conditional logic                      â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
               â”‚                                    â”‚
               â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  Store in Database                        â”‚       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚       â”‚
â”‚  agents table:                            â”‚       â”‚
â”‚  â€¢ Basic config + AIS score               â”‚       â”‚
â”‚  â€¢ pilot_enabled flag                     â”‚       â”‚
â”‚  â€¢ pilot_steps JSON                       â”‚       â”‚
â”‚  â€¢ created_at, updated_at                 â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
               â”‚                                    â”‚
               â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  Audit Trail Entry                        â”‚       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚       â”‚
â”‚  Event: AGENT_CREATED                     â”‚       â”‚
â”‚  â€¢ Agent ID, User ID                      â”‚       â”‚
â”‚  â€¢ AIS score                              â”‚       â”‚
â”‚  â€¢ Pilot configuration                    â”‚       â”‚
â”‚  â€¢ Timestamp                              â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
               â”‚                                    â”‚
               â–¼                                    â”‚
      Agent Ready for Execution â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Flow 2: Agent Execution (Complete Lifecycle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: EXECUTION INITIATION                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Triggers Execution
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /api/run-agent                           â”‚
â”‚  POST with agent_id + context             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Agent Configuration                 â”‚
â”‚  â€¢ Fetch from agents table                â”‚
â”‚  â€¢ Get AIS score                          â”‚
â”‚  â€¢ Get pilot_steps                        â”‚
â”‚  â€¢ Get model_preference                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Approval Requirements              â”‚
â”‚  (if agent requires approval)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â–º Need Approval? â”€â”€â”
               â”‚                      â”‚
               â”‚                      â–¼
               â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚         â”‚ Create Approval Requestâ”‚
               â”‚         â”‚ â€¢ Status: pending      â”‚
               â”‚         â”‚ â€¢ Context snapshot     â”‚
               â”‚         â”‚ â€¢ Wait for admin       â”‚
               â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                  â”‚
               â”‚                  â–¼
               â”‚         Approved? YES â”€â”€â”€â”
               â”‚                          â”‚
               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Execution Record                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  executions table:                        â”‚
â”‚  â€¢ execution_id (UUID)                    â”‚
â”‚  â€¢ agent_id, user_id                      â”‚
â”‚  â€¢ status: 'running'                      â”‚
â”‚  â€¢ context: input data                    â”‚
â”‚  â€¢ started_at: NOW()                      â”‚
â”‚  â€¢ total_steps: pilot_steps.length        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audit Trail Entry                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Event: EXECUTION_STARTED                 â”‚
â”‚  â€¢ Execution ID                           â”‚
â”‚  â€¢ Agent ID, User ID                      â”‚
â”‚  â€¢ Input context                          â”‚
â”‚  â€¢ Timestamp                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3: STEP-BY-STEP EXECUTION (FOR EACH PILOT STEP)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

For stepIndex = 0 to pilot_steps.length - 1:
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Step Configuration                  â”‚
â”‚  â€¢ step_type                              â”‚
â”‚  â€¢ prompt template                        â”‚
â”‚  â€¢ input mappings                         â”‚
â”‚  â€¢ output mappings                        â”‚
â”‚  â€¢ conditional logic                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSYSTEM: MEMORY INJECTION                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  MemoryService.getContextualMemory()                             â”‚
â”‚                                                                   â”‚
â”‚  Query agent_memories table:                                     â”‚
â”‚  â€¢ WHERE agent_id = current_agent                                â”‚
â”‚  â€¢ ORDER BY importance DESC, last_used_at DESC                   â”‚
â”‚  â€¢ LIMIT 10                                                      â”‚
â”‚                                                                   â”‚
â”‚  Memory Types Retrieved:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ 1. execution_outcome                               â”‚          â”‚
â”‚  â”‚    "Previous run: Successfully processed 150 items"â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ 2. user_preference                                 â”‚          â”‚
â”‚  â”‚    "User prefers concise responses"                â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ 3. learned_pattern                                 â”‚          â”‚
â”‚  â”‚    "Data from API X usually needs validation"      â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ 4. routing_pattern (from Routing Memory)           â”‚          â”‚
â”‚  â”‚    "Use tier1 for transform steps (95% success)"   â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ 5. error_recovery                                  â”‚          â”‚
â”‚  â”‚    "Retry with exponential backoff if 429 error"   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  Inject into step context as system message                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSYSTEM: COMPLEXITY ANALYSIS                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  TaskComplexityAnalyzer.analyzeStep()                            â”‚
â”‚                                                                   â”‚
â”‚  Analyze 6 Factors:                                              â”‚
â”‚                                                                   â”‚
â”‚  1ï¸âƒ£ Prompt Length                                               â”‚
â”‚     Raw: 450 characters                                          â”‚
â”‚     Threshold: short=100, medium=500, long=1000                  â”‚
â”‚     Score: 0.35 (medium length)                                  â”‚
â”‚                                                                   â”‚
â”‚  2ï¸âƒ£ Data Size                                                   â”‚
â”‚     Raw: 1,200 tokens in context                                 â”‚
â”‚     Threshold: small=500, medium=2000, large=5000                â”‚
â”‚     Score: 0.25 (small-medium)                                   â”‚
â”‚                                                                   â”‚
â”‚  3ï¸âƒ£ Condition Count                                             â”‚
â”‚     Raw: 3 conditional branches                                  â”‚
â”‚     Threshold: simple=1, moderate=3, complex=5                   â”‚
â”‚     Score: 0.50 (moderate)                                       â”‚
â”‚                                                                   â”‚
â”‚  4ï¸âƒ£ Context Depth                                               â”‚
â”‚     Raw: 2 levels of nesting                                     â”‚
â”‚     Threshold: shallow=1, medium=3, deep=5                       â”‚
â”‚     Score: 0.33 (medium)                                         â”‚
â”‚                                                                   â”‚
â”‚  5ï¸âƒ£ Reasoning Depth                                             â”‚
â”‚     Keywords: "analyze", "compare", "decide"                     â”‚
â”‚     Count: 5 reasoning indicators                                â”‚
â”‚     Score: 0.75 (high reasoning required)                        â”‚
â”‚                                                                   â”‚
â”‚  6ï¸âƒ£ Output Complexity                                           â”‚
â”‚     Structured output: JSON with 8 fields                        â”‚
â”‚     Score: 0.60 (structured output)                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Apply Step-Type Weights (for llm_decision):        â”‚          â”‚
â”‚  â”‚ â€¢ promptLength:     0.35 Ã— 0.15 = 0.0525          â”‚          â”‚
â”‚  â”‚ â€¢ dataSize:         0.25 Ã— 0.15 = 0.0375          â”‚          â”‚
â”‚  â”‚ â€¢ conditionCount:   0.50 Ã— 0.20 = 0.1000          â”‚          â”‚
â”‚  â”‚ â€¢ contextDepth:     0.33 Ã— 0.15 = 0.0495          â”‚          â”‚
â”‚  â”‚ â€¢ reasoningDepth:   0.75 Ã— 0.30 = 0.2250  â—„â”€ High!â”‚          â”‚
â”‚  â”‚ â€¢ outputComplexity: 0.60 Ã— 0.05 = 0.0300          â”‚          â”‚
â”‚  â”‚                                   â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚          â”‚
â”‚  â”‚ Step Complexity Score:            0.4945 (49%)     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  Normalize to 0-10 scale: 4.95                                   â”‚
â”‚                                                                   â”‚
â”‚  ComplexityAnalysis = {                                          â”‚
â”‚    complexityScore: 4.95,                                        â”‚
â”‚    stepType: 'llm_decision',                                     â”‚
â”‚    stepName: 'Analyze Customer Intent',                          â”‚
â”‚    factorScores: { ... },                                        â”‚
â”‚    rawMeasurements: { ... },                                     â”‚
â”‚    appliedWeights: { ... }                                       â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSYSTEM: INTELLIGENT ROUTING                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  PerStepModelRouter.routeStep()                                  â”‚
â”‚                                                                   â”‚
â”‚  Step 1: Check Routing Memory                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ RoutingMemoryService.getRecommendation()           â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ Query agent_memories:                              â”‚          â”‚
â”‚  â”‚ â€¢ memory_type = 'routing_pattern'                  â”‚          â”‚
â”‚  â”‚ â€¢ memory_key = 'routing_llm_decision'              â”‚          â”‚
â”‚  â”‚ â€¢ agent_id = current_agent                         â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ Found Memory:                                      â”‚          â”‚
â”‚  â”‚ {                                                  â”‚          â”‚
â”‚  â”‚   preferredTier: 'tier2',                          â”‚          â”‚
â”‚  â”‚   successRate: 0.92,                               â”‚          â”‚
â”‚  â”‚   confidence: 'high',                              â”‚          â”‚
â”‚  â”‚   totalRuns: 15,                                   â”‚          â”‚
â”‚  â”‚   avgTokens: 800,                                  â”‚          â”‚
â”‚  â”‚   costSavings: 65%                                 â”‚          â”‚
â”‚  â”‚ }                                                  â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ Should Override?                                   â”‚          â”‚
â”‚  â”‚ âœ“ confidence = 'high' (>= 0.8)                     â”‚          â”‚
â”‚  â”‚ âœ“ successRate = 0.92 (> 0.9)                       â”‚          â”‚
â”‚  â”‚ âœ“ totalRuns = 15 (>= 3)                            â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ DECISION: MEMORY OVERRIDE! Use tier2               â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  ğŸ§  MEMORY OVERRIDE ACTIVE                                       â”‚
â”‚     Selected: tier2 (claude-3-5-haiku-20241022)                  â”‚
â”‚     Reason: Historical data shows tier2 performs well            â”‚
â”‚             (92% success, 65% cost savings)                      â”‚
â”‚                                                                   â”‚
â”‚  Skip to routing decision â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                                            â”‚                      â”‚
â”‚  If NO Memory Override:                   â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Step 2: Calculate Effective Complexity â”‚          â”‚          â”‚
â”‚  â”‚                                         â–¼          â”‚          â”‚
â”‚  â”‚ Load Routing Strategy: 'balanced'                 â”‚          â”‚
â”‚  â”‚ â€¢ agentWeight = 0.4 (40%)                         â”‚          â”‚
â”‚  â”‚ â€¢ stepWeight = 0.6 (60%)                          â”‚          â”‚
â”‚  â”‚                                                    â”‚          â”‚
â”‚  â”‚ Agent AIS: 7.5 (from agent config)                â”‚          â”‚
â”‚  â”‚ Step Complexity: 4.95 (from analyzer)             â”‚          â”‚
â”‚  â”‚                                                    â”‚          â”‚
â”‚  â”‚ effectiveComplexity =                             â”‚          â”‚
â”‚  â”‚   (7.5 Ã— 0.4) + (4.95 Ã— 0.6)                      â”‚          â”‚
â”‚  â”‚ = 3.0 + 2.97                                      â”‚          â”‚
â”‚  â”‚ = 5.97                                            â”‚          â”‚
â”‚  â”‚                                                    â”‚          â”‚
â”‚  â”‚ Step 3: Select Tier                               â”‚          â”‚
â”‚  â”‚                                                    â”‚          â”‚
â”‚  â”‚ Thresholds:                                       â”‚          â”‚
â”‚  â”‚ â€¢ tier3: >= 6.0                                   â”‚          â”‚
â”‚  â”‚ â€¢ tier2: >= 3.0                                   â”‚          â”‚
â”‚  â”‚ â€¢ tier1: < 3.0                                    â”‚          â”‚
â”‚  â”‚                                                    â”‚          â”‚
â”‚  â”‚ 5.97 >= 3.0 but < 6.0                             â”‚          â”‚
â”‚  â”‚ â”€â”€â–º SELECT tier2                                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                            â”‚                      â”‚
â”‚                                            â–¼                      â”‚
â”‚  RoutingDecision = {                      â—„â”˜                      â”‚
â”‚    selectedModel: {                                               â”‚
â”‚      provider: 'anthropic',                                       â”‚
â”‚      model: 'claude-3-5-haiku-20241022',                          â”‚
â”‚      tier: 'tier2'                                                â”‚
â”‚    },                                                             â”‚
â”‚    stepComplexity: 4.95,                                          â”‚
â”‚    agentAIS: 7.5,                                                 â”‚
â”‚    effectiveComplexity: 5.97,                                     â”‚
â”‚    routingStrategy: 'balanced',                                   â”‚
â”‚    routingSource: 'routing_memory', // or 'per_step_routing'      â”‚
â”‚    explanation: "MEMORY: Historical data shows tier2..."          â”‚
â”‚  }                                                                â”‚
â”‚                                                                   â”‚
â”‚  ğŸ§­ Model Selected: claude-3-5-haiku-20241022 (tier2)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Execute Step with Selected Model        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  runAgentKit({                            â”‚
â”‚    model: 'claude-3-5-haiku-20241022',    â”‚
â”‚    messages: [                            â”‚
â”‚      { role: 'system', content: memory }, â”‚
â”‚      { role: 'user', content: prompt }    â”‚
â”‚    ],                                     â”‚
â”‚    tools: [...],                          â”‚
â”‚    temperature: 0.7                       â”‚
â”‚  })                                       â”‚
â”‚                                           â”‚
â”‚  Execution starts...                      â”‚
â”‚  â€¢ LLM processes request                  â”‚
â”‚  â€¢ May call tools                         â”‚
â”‚  â€¢ Returns response                       â”‚
â”‚                                           â”‚
â”‚  Result = {                               â”‚
â”‚    response: "...",                       â”‚
â”‚    tokensUsed: { input: 450, output: 350 }â”‚
â”‚    toolCalls: [...]                       â”‚
â”‚  }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Record Routing Decision                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  1ï¸âƒ£ pilot_step_routing_history:          â”‚
â”‚     â€¢ agent_id, execution_id              â”‚
â”‚     â€¢ step_index, step_name, step_type    â”‚
â”‚     â€¢ selected_model, selected_tier       â”‚
â”‚     â€¢ step_complexity: 4.95               â”‚
â”‚     â€¢ agent_ais: 7.5                      â”‚
â”‚     â€¢ effective_complexity: 5.97          â”‚
â”‚     â€¢ routing_source: 'routing_memory'    â”‚
â”‚     â€¢ complexity_factors: JSON            â”‚
â”‚     â€¢ created_at                          â”‚
â”‚                                           â”‚
â”‚  2ï¸âƒ£ audit_logs:                           â”‚
â”‚     Event: PILOT_ROUTING_DECISION         â”‚
â”‚     â€¢ All routing details                 â”‚
â”‚     â€¢ Timestamp, user_id                  â”‚
â”‚     â€¢ Compliance flag: SOC2               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSYSTEM: ROUTING MEMORY LEARNING                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  RoutingMemoryService.learnFromExecution()                       â”‚
â”‚                                                                   â”‚
â”‚  Input:                                                           â”‚
â”‚  â€¢ agentId, userId, executionId                                  â”‚
â”‚  â€¢ stepIndex, stepType: 'llm_decision'                           â”‚
â”‚  â€¢ selectedTier: 'tier2'                                         â”‚
â”‚  â€¢ success: true                                                 â”‚
â”‚  â€¢ tokensUsed: 800                                               â”‚
â”‚  â€¢ executionTimeMs: 1,250                                        â”‚
â”‚  â€¢ costUsd: 0.0012                                               â”‚
â”‚                                                                   â”‚
â”‚  Step 1: Query Historical Patterns                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SELECT * FROM pilot_step_routing_history           â”‚          â”‚
â”‚  â”‚ WHERE agent_id = X                                 â”‚          â”‚
â”‚  â”‚   AND step_type = 'llm_decision'                   â”‚          â”‚
â”‚  â”‚   AND created_at >= NOW() - 30 days                â”‚          â”‚
â”‚  â”‚ ORDER BY created_at DESC                           â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ Found 15 previous executions:                      â”‚          â”‚
â”‚  â”‚ â€¢ tier1: 2 runs (100% success, avg 600 tokens)     â”‚          â”‚
â”‚  â”‚ â€¢ tier2: 13 runs (92% success, avg 800 tokens)     â”‚          â”‚
â”‚  â”‚ â€¢ tier3: 0 runs                                    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  Step 2: Analyze Tier Performance                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ For tier2 (best performing):                       â”‚          â”‚
â”‚  â”‚ â€¢ Total runs: 13                                   â”‚          â”‚
â”‚  â”‚ â€¢ Successful: 12                                   â”‚          â”‚
â”‚  â”‚ â€¢ Success rate: 12/13 = 0.923 (92.3%)              â”‚          â”‚
â”‚  â”‚ â€¢ Avg tokens: 10,400 / 13 = 800                    â”‚          â”‚
â”‚  â”‚ â€¢ Avg cost: $0.0156 / 13 = $0.0012                 â”‚          â”‚
â”‚  â”‚ â€¢ Avg exec time: 16,250ms / 13 = 1,250ms           â”‚          â”‚
â”‚  â”‚ â€¢ Confidence: min(13/10, 1.0) = 1.0 (100%)         â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ Score = 0.923 Ã— (1/0.0012) Ã— 1.0 = 769.17          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  Step 3: Update Pattern with New Data (EMA)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Exponential Moving Average (Î± = 0.3):              â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ newSuccessRate =                                   â”‚          â”‚
â”‚  â”‚   0.923 Ã— 0.7 + 1.0 Ã— 0.3 = 0.946                  â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ newAvgTokens =                                     â”‚          â”‚
â”‚  â”‚   800 Ã— 0.7 + 800 Ã— 0.3 = 800                      â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ newAvgCost =                                       â”‚          â”‚
â”‚  â”‚   0.0012 Ã— 0.7 + 0.0012 Ã— 0.3 = 0.0012             â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚ totalExecutions = 13 + 1 = 14                      â”‚          â”‚
â”‚  â”‚ confidence = min(14/10, 1.0) = 1.0                 â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  Step 4: Store/Update in agent_memories                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ UPSERT INTO agent_memories                         â”‚          â”‚
â”‚  â”‚ (agent_id, memory_key, memory_type, memory_value)  â”‚          â”‚
â”‚  â”‚ VALUES (                                            â”‚          â”‚
â”‚  â”‚   'agent-123',                                     â”‚          â”‚
â”‚  â”‚   'routing_llm_decision',                          â”‚          â”‚
â”‚  â”‚   'routing_pattern',                               â”‚          â”‚
â”‚  â”‚   '{                                               â”‚          â”‚
â”‚  â”‚     "stepType": "llm_decision",                    â”‚          â”‚
â”‚  â”‚     "preferredTier": "tier2",                      â”‚          â”‚
â”‚  â”‚     "successRate": 0.946,                          â”‚          â”‚
â”‚  â”‚     "avgTokens": 800,                              â”‚          â”‚
â”‚  â”‚     "costSavings": 65,                             â”‚          â”‚
â”‚  â”‚     "totalRuns": 14,                               â”‚          â”‚
â”‚  â”‚     "confidence": "high",                          â”‚          â”‚
â”‚  â”‚     "recommendation": "Use tier2 for llm_decision  â”‚          â”‚
â”‚  â”‚                        steps (95% success)"        â”‚          â”‚
â”‚  â”‚   }'                                               â”‚          â”‚
â”‚  â”‚ )                                                  â”‚          â”‚
â”‚  â”‚ ON CONFLICT (agent_id, memory_key)                 â”‚          â”‚
â”‚  â”‚ DO UPDATE SET memory_value = EXCLUDED.memory_value â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  ğŸ’¾ Memory Updated: llm_decision â†’ tier2 (95% success, high conf)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Store Step Results                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Update execution context:                â”‚
â”‚  â€¢ stepResults[stepIndex] = result        â”‚
â”‚  â€¢ completed_steps++                      â”‚
â”‚  â€¢ total_tokens_used += 800               â”‚
â”‚                                           â”‚
â”‚  Update executions table:                 â”‚
â”‚  â€¢ current_step = stepIndex + 1           â”‚
â”‚  â€¢ metrics.tokensUsed += 800              â”‚
â”‚  â€¢ updated_at = NOW()                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audit Trail Entry                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Event: PILOT_STEP_COMPLETED              â”‚
â”‚  â€¢ Step index, name, type                 â”‚
â”‚  â€¢ Tokens used: 800                       â”‚
â”‚  â€¢ Execution time: 1,250ms                â”‚
â”‚  â€¢ Success: true                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â–º More steps? YES â”€â”€â”€â”€â”€â”
               â”‚                          â”‚
               â”‚                          â–¼
               â”‚                   Repeat from top (next step)
               â”‚
               â–¼
        All steps complete

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 4: EXECUTION COMPLETION                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Finalize Execution                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  executions table:                        â”‚
â”‚  â€¢ status = 'completed'                   â”‚
â”‚  â€¢ completed_at = NOW()                   â”‚
â”‚  â€¢ total_tokens = 12,500                  â”‚
â”‚  â€¢ total_cost = $0.0185                   â”‚
â”‚  â€¢ duration_ms = 18,750                   â”‚
â”‚  â€¢ result = final output                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSYSTEM: GENERAL MEMORY STORAGE                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Store execution outcome as memory for future runs:              â”‚
â”‚                                                                   â”‚
â”‚  agent_memories INSERT:                                          â”‚
â”‚  â€¢ memory_type: 'execution_outcome'                              â”‚
â”‚  â€¢ memory_key: 'outcome_<execution_id>'                          â”‚
â”‚  â€¢ memory_value: {                                               â”‚
â”‚      executionId: '...',                                         â”‚
â”‚      success: true,                                              â”‚
â”‚      summary: 'Processed 150 customer orders',                   â”‚
â”‚      tokensUsed: 12500,                                          â”‚
â”‚      duration: 18750,                                            â”‚
â”‚      insights: 'Most orders required tier2 complexity'           â”‚
â”‚    }                                                              â”‚
â”‚  â€¢ importance: 7 (high - successful execution)                   â”‚
â”‚  â€¢ usage_count: 0 (will increment on retrieval)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audit Trail Entry                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Event: EXECUTION_COMPLETED               â”‚
â”‚  â€¢ Execution ID                           â”‚
â”‚  â€¢ Final metrics (tokens, cost, duration) â”‚
â”‚  â€¢ Success status                         â”‚
â”‚  â€¢ Output summary                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSYSTEM: ANALYTICS AGGREGATION                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  AnalyticsService.aggregateMetrics()                             â”‚
â”‚                                                                   â”‚
â”‚  Update analytics_cache table:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Daily Metrics (for today):                         â”‚          â”‚
â”‚  â”‚ â€¢ total_executions++                               â”‚          â”‚
â”‚  â”‚ â€¢ total_tokens += 12,500                           â”‚          â”‚
â”‚  â”‚ â€¢ total_cost += 0.0185                             â”‚          â”‚
â”‚  â”‚ â€¢ avg_duration = rolling average                   â”‚          â”‚
â”‚  â”‚ â€¢ success_rate = successes / total                 â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Per-Agent Metrics:                                 â”‚          â”‚
â”‚  â”‚ â€¢ agent_executions[agent_id]++                     â”‚          â”‚
â”‚  â”‚ â€¢ agent_tokens[agent_id] += 12,500                 â”‚          â”‚
â”‚  â”‚ â€¢ agent_cost[agent_id] += 0.0185                   â”‚          â”‚
â”‚  â”‚ â€¢ agent_avg_ais[agent_id] = 7.5                    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Routing Metrics:                                   â”‚          â”‚
â”‚  â”‚ â€¢ tier1_usage: 2 steps (16%)                       â”‚          â”‚
â”‚  â”‚ â€¢ tier2_usage: 8 steps (67%)  â—„â”€ Most used!        â”‚          â”‚
â”‚  â”‚ â€¢ tier3_usage: 2 steps (17%)                       â”‚          â”‚
â”‚  â”‚ â€¢ memory_overrides: 6 steps (50%)                  â”‚          â”‚
â”‚  â”‚ â€¢ avg_step_complexity: 4.8                         â”‚          â”‚
â”‚  â”‚ â€¢ estimated_savings: $0.0095 (34% vs all tier3)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Time-Series Data (for charts):                     â”‚          â”‚
â”‚  â”‚ â€¢ Hourly token usage trend                         â”‚          â”‚
â”‚  â”‚ â€¢ Daily cost breakdown                             â”‚          â”‚
â”‚  â”‚ â€¢ Model selection distribution                     â”‚          â”‚
â”‚  â”‚ â€¢ Success rate over time                           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        Return result to user
```

---

## ğŸ“Š Analytics & Monitoring Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER VIEWS ANALYTICS DASHBOARD                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User navigates to /analytics
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analytics UI Component                   â”‚
â”‚  useAnalyticsData() hook                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query Multiple Data Sources                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                   â”‚
â”‚  1ï¸âƒ£ Execution Metrics (from executions table)                    â”‚
â”‚     SELECT                                                        â”‚
â”‚       COUNT(*) as total_runs,                                    â”‚
â”‚       SUM(total_tokens) as total_tokens,                         â”‚
â”‚       AVG(duration_ms) as avg_duration,                          â”‚
â”‚       SUM(CASE WHEN status='completed' THEN 1 ELSE 0 END) as successâ”‚
â”‚     FROM executions                                              â”‚
â”‚     WHERE created_at >= date_range                               â”‚
â”‚                                                                   â”‚
â”‚  2ï¸âƒ£ Routing Analytics (from pilot_step_routing_history)          â”‚
â”‚     SELECT                                                        â”‚
â”‚       selected_tier,                                             â”‚
â”‚       COUNT(*) as count,                                         â”‚
â”‚       AVG(step_complexity) as avg_complexity,                    â”‚
â”‚       AVG(tokens_used) as avg_tokens,                            â”‚
â”‚       routing_source                                             â”‚
â”‚     FROM pilot_step_routing_history                              â”‚
â”‚     WHERE created_at >= date_range                               â”‚
â”‚     GROUP BY selected_tier, routing_source                       â”‚
â”‚                                                                   â”‚
â”‚  3ï¸âƒ£ AIS Distribution (from agents table)                         â”‚
â”‚     SELECT                                                        â”‚
â”‚       intensity_score,                                           â”‚
â”‚       COUNT(*) as agent_count                                    â”‚
â”‚     FROM agents                                                  â”‚
â”‚     WHERE pilot_enabled = true                                   â”‚
â”‚     GROUP BY intensity_score                                     â”‚
â”‚                                                                   â”‚
â”‚  4ï¸âƒ£ Memory Effectiveness (from agent_memories)                   â”‚
â”‚     SELECT                                                        â”‚
â”‚       COUNT(*) as total_patterns,                                â”‚
â”‚       AVG(importance) as avg_importance,                         â”‚
â”‚       SUM(usage_count) as total_memory_uses                      â”‚
â”‚     FROM agent_memories                                          â”‚
â”‚     WHERE memory_type = 'routing_pattern'                        â”‚
â”‚                                                                   â”‚
â”‚  5ï¸âƒ£ Cost Analysis (calculated)                                   â”‚
â”‚     - Actual cost (from routing history)                         â”‚
â”‚     - Baseline cost (if all tier3)                               â”‚
â”‚     - Savings = baseline - actual                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Aggregate & Calculate Metrics            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  analyticsHelpers.calculateMetrics()      â”‚
â”‚                                           â”‚
â”‚  Derived Metrics:                         â”‚
â”‚  â€¢ Token efficiency (tokens/run)          â”‚
â”‚  â€¢ Cost efficiency ($/run)                â”‚
â”‚  â€¢ Model distribution (% per tier)        â”‚
â”‚  â€¢ Memory impact (% overrides)            â”‚
â”‚  â€¢ AIS correlation (complexity vs AIS)    â”‚
â”‚  â€¢ Time-based trends (hourly/daily)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Render Dashboard Components              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ MetricsCards (total runs, tokens, etc) â”‚
â”‚  â€¢ Charts (token usage, cost trends)      â”‚
â”‚  â€¢ Tables (top agents, routing breakdown) â”‚
â”‚  â€¢ Insights (recommendations)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Display to user:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Analytics Dashboard                                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Total    â”‚ â”‚ Tokens   â”‚ â”‚ Cost     â”‚ â”‚ Savings  â”‚  â”‚
â”‚  â”‚ 1,247    â”‚ â”‚ 1.2M     â”‚ â”‚ $18.50   â”‚ â”‚ $12.30   â”‚  â”‚
â”‚  â”‚ runs     â”‚ â”‚          â”‚ â”‚          â”‚ â”‚ (40%)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  Model Distribution:                                   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ tier1: 45% (cost-efficient)                â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ tier2: 38% (balanced)                  â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ tier3: 17% (complex tasks)                     â”‚
â”‚                                                         â”‚
â”‚  Memory Impact:                                        â”‚
â”‚  â€¢ 52% of decisions used learned patterns              â”‚
â”‚  â€¢ Average confidence: 85%                             â”‚
â”‚  â€¢ Memory-based routing saved $8.20                    â”‚
â”‚                                                         â”‚
â”‚  Top Agents by Efficiency:                             â”‚
â”‚  1. Customer Support Bot (AIS: 6) - 58% savings        â”‚
â”‚  2. Data Processor (AIS: 4) - 63% savings              â”‚
â”‚  3. Report Generator (AIS: 7) - 42% savings            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Audit Trail & Compliance Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUDIT TRAIL - ALL SYSTEM EVENTS                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Every significant action triggers audit logging:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuditTrailService.log()                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Singleton service that logs all events                          â”‚
â”‚                                                                   â”‚
â”‚  Event Categories:                                               â”‚
â”‚                                                                   â”‚
â”‚  1ï¸âƒ£ AGENT LIFECYCLE                                             â”‚
â”‚     â€¢ AGENT_CREATED                                              â”‚
â”‚     â€¢ AGENT_UPDATED                                              â”‚
â”‚     â€¢ AGENT_DELETED                                              â”‚
â”‚     â€¢ AGENT_SHARED                                               â”‚
â”‚                                                                   â”‚
â”‚  2ï¸âƒ£ EXECUTION EVENTS                                            â”‚
â”‚     â€¢ EXECUTION_STARTED                                          â”‚
â”‚     â€¢ EXECUTION_COMPLETED                                        â”‚
â”‚     â€¢ EXECUTION_FAILED                                           â”‚
â”‚     â€¢ PILOT_STEP_STARTED                                         â”‚
â”‚     â€¢ PILOT_STEP_COMPLETED                                       â”‚
â”‚     â€¢ PILOT_STEP_FAILED                                          â”‚
â”‚                                                                   â”‚
â”‚  3ï¸âƒ£ ROUTING EVENTS (NEW!)                                       â”‚
â”‚     â€¢ PILOT_ROUTING_DECISION     â—„â”€ Per-step model selection     â”‚
â”‚     â€¢ PILOT_ROUTING_ENABLED      â—„â”€ System config change         â”‚
â”‚     â€¢ PILOT_ROUTING_DISABLED                                     â”‚
â”‚     â€¢ PILOT_ROUTING_CONFIG_UPDATED â—„â”€ AIS config change          â”‚
â”‚                                                                   â”‚
â”‚  4ï¸âƒ£ APPROVAL EVENTS                                             â”‚
â”‚     â€¢ APPROVAL_REQUESTED                                         â”‚
â”‚     â€¢ APPROVAL_GRANTED                                           â”‚
â”‚     â€¢ APPROVAL_DENIED                                            â”‚
â”‚                                                                   â”‚
â”‚  5ï¸âƒ£ CONFIGURATION EVENTS                                        â”‚
â”‚     â€¢ SYSTEM_CONFIG_UPDATED                                      â”‚
â”‚     â€¢ AIS_CONFIG_UPDATED                                         â”‚
â”‚     â€¢ MEMORY_CONFIG_UPDATED                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Store in audit_logs table                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Schema:                                  â”‚
â”‚  â€¢ id (UUID)                              â”‚
â”‚  â€¢ action (event type)                    â”‚
â”‚  â€¢ entity_type (agent/execution/config)   â”‚
â”‚  â€¢ entity_id (target ID)                  â”‚
â”‚  â€¢ user_id (who did it)                   â”‚
â”‚  â€¢ resource_name (descriptive name)       â”‚
â”‚  â€¢ details (JSONB - full context)         â”‚
â”‚  â€¢ severity (info/warning/error)          â”‚
â”‚  â€¢ compliance_flags (SOC2, GDPR, etc)     â”‚
â”‚  â€¢ ip_address                             â”‚
â”‚  â€¢ created_at                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        Indexed for fast querying

Example audit log for routing decision:
{
  "id": "uuid-...",
  "action": "PILOT_ROUTING_DECISION",
  "entity_type": "execution",
  "entity_id": "exec-uuid-...",
  "user_id": "user-uuid-...",
  "resource_name": "Analyze Customer Intent",
  "details": {
    "agent_id": "agent-uuid-...",
    "step_index": 2,
    "step_type": "llm_decision",
    "selected_model": "anthropic:claude-3-5-haiku-20241022",
    "selected_tier": "tier2",
    "step_complexity": "4.95",
    "agent_ais": "7.50",
    "effective_complexity": "5.97",
    "routing_strategy": "balanced",
    "routing_source": "routing_memory",
    "explanation": "MEMORY: Historical data shows tier2 performs well..."
  },
  "severity": "info",
  "compliance_flags": ["SOC2"],
  "ip_address": "192.168.1.100",
  "created_at": "2025-11-03T14:23:45.123Z"
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLIANCE & REPORTING                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Query audit trail for compliance:

-- All routing decisions for an execution
SELECT * FROM audit_logs
WHERE action = 'PILOT_ROUTING_DECISION'
  AND entity_id = 'execution-uuid'
ORDER BY created_at ASC;

-- All actions by a user
SELECT * FROM audit_logs
WHERE user_id = 'user-uuid'
  AND created_at >= '2025-11-01'
ORDER BY created_at DESC;

-- All SOC2-relevant events
SELECT * FROM audit_logs
WHERE 'SOC2' = ANY(compliance_flags)
ORDER BY created_at DESC;

-- Routing configuration changes
SELECT * FROM audit_logs
WHERE action IN (
  'PILOT_ROUTING_ENABLED',
  'PILOT_ROUTING_DISABLED',
  'PILOT_ROUTING_CONFIG_UPDATED',
  'AIS_CONFIG_UPDATED'
)
ORDER BY created_at DESC;
```

---

## ğŸ” Memory System - Complete Learning Cycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MEMORY LIFECYCLE - FROM CAPTURE TO USAGE                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Execution 1-2 (Cold Start)
      â”‚
      â–¼
No memory exists yet
Use complexity-based routing
      â”‚
      â–¼
Record outcomes in pilot_step_routing_history
      â”‚
      â”‚
Execution 3 (Learning Begins)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoutingMemoryService.learnFromExecution â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Query last 30 days of routing history    â”‚
â”‚  Found: 3 executions for llm_decision     â”‚
â”‚                                           â”‚
â”‚  Tier performance:                        â”‚
â”‚  â€¢ tier1: 1 run (100% success)            â”‚
â”‚  â€¢ tier2: 2 runs (100% success)           â”‚
â”‚                                           â”‚
â”‚  Best tier: tier2 (lower cost)            â”‚
â”‚  Confidence: 3/10 = 0.3 (30%)             â”‚
â”‚                                           â”‚
â”‚  Store in agent_memories:                 â”‚
â”‚  {                                        â”‚
â”‚    stepType: 'llm_decision',              â”‚
â”‚    preferredTier: 'tier2',                â”‚
â”‚    successRate: 1.0,                      â”‚
â”‚    confidence: 'low',  â—„â”€ Not confident yetâ”‚
â”‚    totalRuns: 3                           â”‚
â”‚  }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
Memory exists but confidence too low
Continue using complexity-based routing
      â”‚
      â”‚
Execution 4-6 (Building Confidence)
      â”‚
      â–¼
Each execution updates memory with EMA
Confidence increases: 0.3 â†’ 0.4 â†’ 0.5 â†’ 0.6
Success rate stabilizes: 1.0 â†’ 0.95 â†’ 0.93
      â”‚
      â”‚
Execution 7+ (Memory-Driven)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoutingMemoryService.getRecommendation  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Query agent_memories                     â”‚
â”‚  Found pattern with:                      â”‚
â”‚  â€¢ confidence: 'medium' (0.7)             â”‚
â”‚  â€¢ successRate: 0.93                      â”‚
â”‚  â€¢ totalRuns: 7                           â”‚
â”‚                                           â”‚
â”‚  Check override criteria:                 â”‚
â”‚  âœ“ confidence >= 0.6                      â”‚
â”‚  âœ— successRate < 0.95 (need 95% for medium)â”‚
â”‚                                           â”‚
â”‚  Decision: DON'T OVERRIDE (not confident) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
Continue building confidence
      â”‚
      â”‚
Execution 10+ (Fully Optimized)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Memory now highly confident:             â”‚
â”‚  â€¢ confidence: 'high' (1.0)               â”‚
â”‚  â€¢ successRate: 0.95                      â”‚
â”‚  â€¢ totalRuns: 12                          â”‚
â”‚  â€¢ avgTokens: 800                         â”‚
â”‚  â€¢ costSavings: 65%                       â”‚
â”‚                                           â”‚
â”‚  Check override criteria:                 â”‚
â”‚  âœ“ confidence = 'high'                    â”‚
â”‚  âœ“ successRate = 0.95 (> 0.9 threshold)   â”‚
â”‚                                           â”‚
â”‚  Decision: OVERRIDE! Use tier2            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Memory-based routing now active          â”‚
â”‚  Skip complexity calculation              â”‚
â”‚  Use learned pattern directly             â”‚
â”‚  routing_source = 'routing_memory'        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
System continues learning and adapting
If success rate drops, confidence lowers
If new pattern emerges, preference changes

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MEMORY TYPES IN SYSTEM                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

agent_memories table stores multiple memory types:

1. routing_pattern (Routing Memory System)
   â€¢ Learned model preferences per step type
   â€¢ Used for intelligent routing decisions
   â€¢ Key: routing_{stepType}

2. execution_outcome (General Memory)
   â€¢ Results from past executions
   â€¢ Injected into future runs as context
   â€¢ Key: outcome_{executionId}

3. user_preference (User Behavior)
   â€¢ Learned user preferences
   â€¢ Response style, detail level, etc.
   â€¢ Key: preference_{category}

4. learned_pattern (Domain Knowledge)
   â€¢ Patterns discovered during execution
   â€¢ Data validation rules, etc.
   â€¢ Key: pattern_{domain}

5. error_recovery (Resilience)
   â€¢ How to handle specific errors
   â€¢ Retry strategies, fallbacks
   â€¢ Key: error_{errorType}

All memory types:
â€¢ Have importance score (0-10)
â€¢ Track usage_count (incremented on retrieval)
â€¢ Have last_used_at timestamp
â€¢ Can be queried and injected into agent context
```

---

## ğŸ¯ Complete Data Flow Summary

```
USER ACTION
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CREATE AGENT       â”‚â”€â”€â–º AIS Analysis â”€â”€â–º Score (0-10) â”€â”€â–º Store
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RUN EXECUTION      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    FOR EACH STEP:
    â”‚
    â”œâ”€â–º 1. Load Memory (agent_memories) â”€â”€â–º Inject into context
    â”‚
    â”œâ”€â–º 2. Analyze Complexity (6 factors) â”€â”€â–º Complexity score (0-10)
    â”‚
    â”œâ”€â–º 3. Check Routing Memory â”€â”€â–º Override? â”€â”€â”
    â”‚                                            â”‚
    â”œâ”€â–º 4. Calculate Effective Complexity â—„â”€â”€â”€â”€â”€â”˜
    â”‚      (AIS + Step Complexity)
    â”‚
    â”œâ”€â–º 5. Select Model Tier (tier1/2/3)
    â”‚
    â”œâ”€â–º 6. Execute with Selected Model â”€â”€â–º Result + tokens
    â”‚
    â”œâ”€â–º 7. Record Decision â”€â”€â”¬â”€â–º pilot_step_routing_history
    â”‚                         â””â”€â–º audit_logs (SOC2)
    â”‚
    â”œâ”€â–º 8. Learn from Outcome â”€â”€â–º Update agent_memories
    â”‚
    â””â”€â–º 9. Store Results â”€â”€â–º execution context

    â–¼
ALL STEPS COMPLETE
    â”‚
    â”œâ”€â–º Store Execution Outcome â”€â”€â–º agent_memories
    â”‚
    â”œâ”€â–º Log Completion â”€â”€â–º audit_logs
    â”‚
    â””â”€â–º Aggregate Analytics â”€â”€â–º analytics_cache

    â–¼
USER VIEWS RESULTS
    â”‚
    â”œâ”€â–º Dashboard â”€â”€â–º Query analytics_cache + executions
    â”‚
    â”œâ”€â–º Audit Trail â”€â”€â–º Query audit_logs (compliance)
    â”‚
    â””â”€â–º Insights â”€â”€â–º Query agent_memories (learned patterns)
```

---

## ğŸ“ˆ System Benefits & Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTIMIZATION OVER TIME                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Week 1 (Cold Start):
â€¢ No memory, pure complexity-based routing
â€¢ Token usage: baseline
â€¢ Cost: baseline

Week 2 (Learning):
â€¢ Memory patterns emerging (3-10 runs per agent)
â€¢ Some memory overrides (low-medium confidence)
â€¢ Token reduction: 15-25%
â€¢ Cost reduction: 20-30%

Week 4 (Optimized):
â€¢ High-confidence memory patterns
â€¢ Frequent memory overrides (50-70% of decisions)
â€¢ Token reduction: 30-50%
â€¢ Cost reduction: 40-60%

Month 3+ (Fully Tuned):
â€¢ Mature memory patterns for all agents
â€¢ Optimal tier selection per step type
â€¢ Adaptive to usage patterns
â€¢ Token reduction: 40-60%
â€¢ Cost reduction: 50-70%
â€¢ Improved execution speed (faster models for simple tasks)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KEY METRICS TRACKED                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Efficiency Metrics:
   â€¢ Tokens per execution (trend down)
   â€¢ Cost per execution (trend down)
   â€¢ Execution duration (trend down for simple, stable for complex)

2. Quality Metrics:
   â€¢ Success rate (maintain high)
   â€¢ Error rate (trend down)
   â€¢ Memory confidence (trend up)

3. Routing Metrics:
   â€¢ Tier distribution (optimize toward lower tiers)
   â€¢ Memory override rate (trend up as confidence builds)
   â€¢ Complexity accuracy (routing matches actual needs)

4. Business Metrics:
   â€¢ Total cost savings (cumulative)
   â€¢ Token efficiency improvement (%)
   â€¢ Agent performance improvement (faster + cheaper)
```

---

**Document Status**: Complete System Flow - All Subsystems Integrated
**Version**: 1.0
**Last Updated**: 2025-11-03
**Coverage**: AIS, Memory, Routing, Executions, Audit Trail, Analytics
